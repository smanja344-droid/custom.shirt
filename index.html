<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Tees | Complete Full-Stack Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@800;900&display=swap" rel="stylesheet">
    
    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #3498db;
            --primary-dark: #2980b9;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --gray-color: #95a5a6;
            --light-gray: #f8f9fa;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --border-radius: 8px;
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: var(--dark-color);
            background-color: #f5f7fa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Typography */
        h1, h2, h3, h4 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 800;
            margin-bottom: 1rem;
        }

        h1 {
            font-size: 3rem;
            line-height: 1.2;
        }

        h2 {
            font-size: 2.5rem;
        }

        h3 {
            font-size: 1.8rem;
        }

        p {
            margin-bottom: 1rem;
            color: #666;
        }

        /* Header & Navigation */
        .header {
            background-color: white;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--primary-color);
        }

        .logo i {
            margin-right: 10px;
            font-size: 2rem;
        }

        .nav-links {
            display: flex;
            list-style: none;
        }

        .nav-links li {
            margin: 0 1rem;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--dark-color);
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: var(--primary-color);
            background-color: rgba(52, 152, 219, 0.1);
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--dark-color);
            cursor: pointer;
        }

        /* Buttons */
        .btn {
            padding: 0.6rem 1.5rem;
            border-radius: var(--border-radius);
            border: none;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
        }

        .btn-outline {
            background-color: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn-outline:hover {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
        }

        .cart-count {
            background-color: var(--accent-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            position: absolute;
            top: -5px;
            right: -5px;
        }

        /* Hero Section */
        .hero-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            padding: 4rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
            align-items: center;
        }

        .hero-content h1 {
            margin-bottom: 1.5rem;
        }

        .hero-content p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            color: #666;
        }

        .hero-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .hero-image img {
            width: 100%;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            transition: transform 0.5s ease;
        }

        .hero-image img:hover {
            transform: scale(1.02);
        }

        /* Sections */
        .section-header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 0 1rem;
        }

        .products-section,
        .customization-section,
        .orders-section,
        .admin-section {
            padding: 4rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Products Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
        }

        .product-card {
            background-color: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .product-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }

        .product-image {
            height: 200px;
            overflow: hidden;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-info {
            padding: 1.5rem;
        }

        .product-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        /* Customization */
        .customization-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            background-color: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--shadow);
        }

        .color-options {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition);
        }

        .color-option.active {
            border-color: var(--primary-color);
            transform: scale(1.2);
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-control {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        /* Cart Items */
        .cart-items {
            max-height: 400px;
            overflow-y: auto;
        }

        .cart-item {
            display: flex;
            padding: 1rem 0;
            border-bottom: 1px solid #eee;
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            padding: 1rem;
            background-color: var(--light-gray);
            border-radius: var(--border-radius);
        }

        /* Admin */
        .admin-tabs {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 1px solid #eee;
            overflow-x: auto;
        }

        .admin-tab {
            padding: 1rem 2rem;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }

        .admin-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
        }

        .admin-table th,
        .admin-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 3000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
            min-width: 300px;
            transform: translateX(100%);
            animation: slideIn 0.3s forwards;
        }

        @keyframes slideIn {
            to { transform: translateX(0); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .menu-toggle {
                display: block;
            }
            
            .hero-section,
            .customization-container {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="navbar">
            <div class="logo">
                <i class="fas fa-tshirt"></i>
                <span>Custom Tees</span>
            </div>
            
            <ul class="nav-links">
                <li><a href="#home" class="active">Home</a></li>
                <li><a href="#shop">Shop</a></li>
                <li><a href="#customize">Customize</a></li>
                <li><a href="#orders">Orders</a></li>
                <li id="admin-link" style="display: none;"><a href="#admin">Admin</a></li>
            </ul>
            
            <div class="nav-actions">
                <button class="btn btn-outline" id="login-btn">Login</button>
                <button class="btn btn-primary" id="cart-btn">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count">0</span>
                </button>
                <button class="btn btn-text" id="profile-btn" style="display: none;">
                    <i class="fas fa-user"></i>
                </button>
                <button class="btn btn-text" id="logout-btn" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
            
            <button class="menu-toggle" id="menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Hero Section -->
        <section id="home" class="hero-section">
            <div class="hero-content">
                <h1>Design Your Perfect T-Shirt</h1>
                <p>Create custom t-shirts with your own designs or choose from our collection. Quality fabrics, perfect fit.</p>
                <div class="hero-buttons">
                    <button class="btn btn-primary btn-large" id="shop-now-btn">Shop Now</button>
                    <button class="btn btn-outline btn-large" id="custom-design-btn">Start Custom Design</button>
                </div>
            </div>
            <div class="hero-image">
                <img src="https://images.unsplash.com/photo-1523381210434-271e8be1f52b?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80" alt="Custom T-Shirt Design">
            </div>
        </section>

        <!-- Products Section -->
        <section id="shop" class="products-section">
            <div class="section-header">
                <h2>Featured Products</h2>
                <p>Choose from our premium collection of t-shirts</p>
            </div>
            
            <div class="products-grid" id="products-grid">
                <!-- Products will be loaded here -->
            </div>
        </section>

        <!-- Customization Section -->
        <section id="customize" class="customization-section">
            <div class="section-header">
                <h2>Customize Your T-Shirt</h2>
                <p>Upload your design or artwork to create a unique t-shirt</p>
            </div>
            
            <div class="customization-container">
                <div class="customization-preview">
                    <div class="tshirt-preview">
                        <canvas id="tshirtCanvas" width="400" height="400"></canvas>
                    </div>
                    
                    <div class="color-options" id="color-options">
                        <div class="color-option active" data-color="#ffffff" style="background-color: #ffffff;"></div>
                        <div class="color-option" data-color="#000000" style="background-color: #000000;"></div>
                        <div class="color-option" data-color="#2c3e50" style="background-color: #2c3e50;"></div>
                        <div class="color-option" data-color="#3498db" style="background-color: #3498db;"></div>
                    </div>
                </div>
                
                <div class="customization-form">
                    <h3>Design Details</h3>
                    
                    <div class="form-group">
                        <label for="product-select">Select T-Shirt Type</label>
                        <select id="product-select" class="form-control">
                            <option value="" disabled selected>Choose a product</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="size-select">Select Size</label>
                        <div class="size-options" id="size-options">
                            <!-- Sizes will be loaded here -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="customization-notes">Customization Notes</label>
                        <textarea id="customization-notes" class="form-control" rows="3" placeholder="Any special instructions..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <button class="btn btn-primary btn-block" id="add-to-cart-btn">
                            <i class="fas fa-cart-plus"></i> Add to Cart - $<span id="product-price">24.99</span>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Cart Modal -->
        <div class="modal" id="cart-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Your Cart</h3>
                    <button class="modal-close" id="close-cart-modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="cart-items" id="cart-items">
                        <!-- Cart items will be loaded here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="cart-total">
                        <span>Total:</span>
                        <span class="total-amount">$0.00</span>
                    </div>
                    <button class="btn btn-primary btn-block" id="checkout-btn">Proceed to Checkout</button>
                </div>
            </div>
        </div>

        <!-- Checkout Modal -->
        <div class="modal" id="checkout-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Checkout</h3>
                    <button class="modal-close" id="close-checkout-modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="checkout-form">
                        <div class="form-group">
                            <label for="customer-name">Full Name *</label>
                            <input type="text" id="customer-name" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="customer-email">Email Address *</label>
                            <input type="email" id="customer-email" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="customer-phone">Phone Number *</label>
                            <input type="tel" id="customer-phone" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="shipping-address">Shipping Address *</label>
                            <textarea id="shipping-address" class="form-control" rows="3" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary btn-block">
                                <i class="fas fa-check-circle"></i> Place Order
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Login Modal -->
        <div class="modal" id="login-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Welcome Back</h3>
                    <button class="modal-close" id="close-login-modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="auth-tabs">
                        <button class="auth-tab active" data-tab="login">Login</button>
                        <button class="auth-tab" data-tab="signup">Sign Up</button>
                    </div>
                    
                    <form id="login-form" class="auth-form active">
                        <div class="form-group">
                            <label for="login-email">Email</label>
                            <input type="email" id="login-email" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="login-password">Password</label>
                            <input type="password" id="login-password" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary btn-block">
                                <i class="fas fa-sign-in-alt"></i> Login
                            </button>
                        </div>
                        
                        <div style="text-align: center; margin-top: 1rem;">
                            <div class="demo-badge">
                                Demo: admin@example.com / admin123
                            </div>
                        </div>
                    </form>
                    
                    <form id="signup-form" class="auth-form">
                        <div class="form-group">
                            <label for="signup-name">Full Name</label>
                            <input type="text" id="signup-name" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="signup-email">Email</label>
                            <input type="email" id="signup-email" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="signup-password">Password</label>
                            <input type="password" id="signup-password" class="form-control" required minlength="6">
                        </div>
                        
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary btn-block">
                                <i class="fas fa-user-plus"></i> Create Account
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <section id="admin" class="admin-section" style="display: none;">
            <div class="section-header">
                <h2>Admin Dashboard</h2>
                <p>Manage your entire business from one place</p>
            </div>
            
            <div class="admin-tabs">
                <button class="admin-tab active" data-tab="orders">Orders</button>
                <button class="admin-tab" data-tab="products">Products</button>
                <button class="admin-tab" data-tab="customers">Customers</button>
            </div>
            
            <div class="admin-content">
                <!-- Orders Tab -->
                <div class="admin-tab-content active" id="admin-orders">
                    <div class="admin-table-container">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Customer</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody id="admin-orders-table">
                                <!-- Orders will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Products Tab -->
                <div class="admin-tab-content" id="admin-products">
                    <div style="margin-bottom: 1rem;">
                        <button class="btn btn-primary" onclick="showAddProductModal()">
                            <i class="fas fa-plus"></i> Add Product
                        </button>
                    </div>
                    <div class="admin-table-container">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Category</th>
                                    <th>Price</th>
                                    <th>Stock</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="admin-products-table">
                                <!-- Products will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Orders Section -->
        <section id="orders" class="orders-section">
            <div class="section-header">
                <h2>Your Orders</h2>
                <p>Track the status of your orders</p>
            </div>
            
            <div class="orders-container" id="orders-container">
                <!-- Orders will be loaded here -->
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>Custom Tees</h4>
                <p>Creating unique t-shirts since 2023</p>
            </div>
        </div>
    </footer>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Backend in JavaScript -->
    <script type="module">
        // ============================================
        // BACKEND SERVER (Node.js + Express in Browser)
        // ============================================
        
        // Mock database using localStorage
        class Database {
            constructor() {
                this.initDatabase();
            }
            
            initDatabase() {
                // Initialize with sample data if empty
                if (!localStorage.getItem('users')) {
                    localStorage.setItem('users', JSON.stringify([
                        {
                            id: '1',
                            email: 'admin@example.com',
                            password: 'admin123',
                            name: 'Admin User',
                            role: 'admin',
                            createdAt: new Date().toISOString()
                        }
                    ]));
                }
                
                if (!localStorage.getItem('products')) {
                    localStorage.setItem('products', JSON.stringify([
                        {
                            id: '1',
                            name: 'Premium Cotton T-Shirt',
                            description: '100% cotton, soft and comfortable',
                            price: 29.99,
                            category: 'unisex',
                            sizes: ['S', 'M', 'L', 'XL'],
                            stock: 100,
                            image: 'https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
                        },
                        {
                            id: '2',
                            name: 'Classic Polo Shirt',
                            description: 'Premium polo shirt with logo',
                            price: 39.99,
                            category: 'men',
                            sizes: ['M', 'L', 'XL', 'XXL'],
                            stock: 75,
                            image: 'https://images.unsplash.com/photo-1586790170083-2f9ceadc732d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
                        }
                    ]));
                }
                
                if (!localStorage.getItem('orders')) {
                    localStorage.setItem('orders', JSON.stringify([]));
                }
                
                if (!localStorage.getItem('cart')) {
                    localStorage.setItem('cart', JSON.stringify([]));
                }
            }
            
            // User methods
            async findUserByEmail(email) {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                return users.find(user => user.email === email);
            }
            
            async createUser(userData) {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const newUser = {
                    id: Date.now().toString(),
                    ...userData,
                    role: 'customer',
                    createdAt: new Date().toISOString()
                };
                users.push(newUser);
                localStorage.setItem('users', JSON.stringify(users));
                return newUser;
            }
            
            // Product methods
            async getProducts() {
                return JSON.parse(localStorage.getItem('products') || '[]');
            }
            
            async createProduct(productData) {
                const products = JSON.parse(localStorage.getItem('products') || '[]');
                const newProduct = {
                    id: Date.now().toString(),
                    ...productData
                };
                products.push(newProduct);
                localStorage.setItem('products', JSON.stringify(products));
                return newProduct;
            }
            
            // Order methods
            async createOrder(orderData) {
                const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                const newOrder = {
                    id: 'ORD' + Date.now().toString().slice(-8),
                    ...orderData,
                    status: 'pending',
                    createdAt: new Date().toISOString()
                };
                orders.push(newOrder);
                localStorage.setItem('orders', JSON.stringify(orders));
                return newOrder;
            }
            
            async getOrders(userId = null) {
                const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                if (userId) {
                    return orders.filter(order => order.userId === userId);
                }
                return orders;
            }
            
            async updateOrder(orderId, updates) {
                const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                const index = orders.findIndex(order => order.id === orderId);
                if (index !== -1) {
                    orders[index] = { ...orders[index], ...updates };
                    localStorage.setItem('orders', JSON.stringify(orders));
                    return orders[index];
                }
                return null;
            }
            
            // Cart methods
            async getCart(userId) {
                const carts = JSON.parse(localStorage.getItem('cart') || '[]');
                return carts.find(cart => cart.userId === userId)?.items || [];
            }
            
            async updateCart(userId, items) {
                const carts = JSON.parse(localStorage.getItem('cart') || '[]');
                const index = carts.findIndex(cart => cart.userId === userId);
                if (index !== -1) {
                    carts[index].items = items;
                } else {
                    carts.push({ userId, items });
                }
                localStorage.setItem('cart', JSON.stringify(carts));
            }
        }

        // Backend API Simulation
        class BackendAPI {
            constructor() {
                this.db = new Database();
                this.currentUser = null;
            }
            
            // Authentication
            async login(email, password) {
                const user = await this.db.findUserByEmail(email);
                if (!user || user.password !== password) {
                    throw new Error('Invalid credentials');
                }
                
                // Remove password from response
                const { password: _, ...userWithoutPassword } = user;
                this.currentUser = userWithoutPassword;
                
                return {
                    success: true,
                    user: userWithoutPassword,
                    token: 'mock-jwt-token-' + Date.now()
                };
            }
            
            async signup(userData) {
                // Check if user exists
                const existingUser = await this.db.findUserByEmail(userData.email);
                if (existingUser) {
                    throw new Error('User already exists');
                }
                
                const user = await this.db.createUser(userData);
                const { password: _, ...userWithoutPassword } = user;
                this.currentUser = userWithoutPassword;
                
                return {
                    success: true,
                    user: userWithoutPassword,
                    token: 'mock-jwt-token-' + Date.now()
                };
            }
            
            logout() {
                this.currentUser = null;
                return { success: true };
            }
            
            // Products
            async getProducts() {
                return await this.db.getProducts();
            }
            
            async createProduct(productData) {
                if (!this.currentUser || this.currentUser.role !== 'admin') {
                    throw new Error('Unauthorized');
                }
                return await this.db.createProduct(productData);
            }
            
            // Orders
            async createOrder(orderData) {
                if (!this.currentUser) {
                    throw new Error('Please login first');
                }
                
                const order = await this.db.createOrder({
                    ...orderData,
                    userId: this.currentUser.id
                });
                
                // Clear cart after order
                await this.db.updateCart(this.currentUser.id, []);
                
                return order;
            }
            
            async getOrders() {
                if (!this.currentUser) {
                    throw new Error('Please login first');
                }
                
                if (this.currentUser.role === 'admin') {
                    return await this.db.getOrders();
                }
                
                return await this.db.getOrders(this.currentUser.id);
            }
            
            async updateOrder(orderId, updates) {
                if (!this.currentUser || this.currentUser.role !== 'admin') {
                    throw new Error('Unauthorized');
                }
                return await this.db.updateOrder(orderId, updates);
            }
            
            // Cart
            async getCart() {
                if (!this.currentUser) {
                    return [];
                }
                return await this.db.getCart(this.currentUser.id);
            }
            
            async updateCart(items) {
                if (!this.currentUser) {
                    throw new Error('Please login first');
                }
                return await this.db.updateCart(this.currentUser.id, items);
            }
        }

        // ============================================
        // FRONTEND APPLICATION
        // ============================================
        
        const api = new BackendAPI();
        let cart = [];
        let currentTshirtColor = '#ffffff';

        // DOM Elements
        const elements = {
            loginBtn: document.getElementById('login-btn'),
            logoutBtn: document.getElementById('logout-btn'),
            profileBtn: document.getElementById('profile-btn'),
            cartBtn: document.getElementById('cart-btn'),
            cartModal: document.getElementById('cart-modal'),
            checkoutModal: document.getElementById('checkout-modal'),
            loginModal: document.getElementById('login-modal'),
            productsGrid: document.getElementById('products-grid'),
            productSelect: document.getElementById('product-select'),
            sizeOptions: document.getElementById('size-options'),
            addToCartBtn: document.getElementById('add-to-cart-btn'),
            checkoutForm: document.getElementById('checkout-form'),
            loginForm: document.getElementById('login-form'),
            signupForm: document.getElementById('signup-form'),
            adminLink: document.getElementById('admin-link'),
            adminSection: document.querySelector('.admin-section')
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            initializeEventListeners();
            await loadProducts();
            updateCartUI();
            checkAuthState();
        });

        function initializeEventListeners() {
            // Navigation
            elements.loginBtn.addEventListener('click', () => showModal('login-modal'));
            elements.logoutBtn.addEventListener('click', handleLogout);
            elements.cartBtn.addEventListener('click', () => showModal('cart-modal'));
            
            // Modal close buttons
            document.getElementById('close-cart-modal')?.addEventListener('click', () => hideModal('cart-modal'));
            document.getElementById('close-checkout-modal')?.addEventListener('click', () => hideModal('checkout-modal'));
            document.getElementById('close-login-modal')?.addEventListener('click', () => hideModal('login-modal'));
            
            // Checkout
            elements.checkoutBtn?.addEventListener('click', () => {
                if (cart.length === 0) {
                    showToast('Your cart is empty', 'error');
                    return;
                }
                hideModal('cart-modal');
                showModal('checkout-modal');
            });
            
            // Add to cart
            elements.addToCartBtn?.addEventListener('click', addToCart);
            
            // Checkout form
            elements.checkoutForm?.addEventListener('submit', handleCheckout);
            
            // Auth forms
            elements.loginForm?.addEventListener('submit', handleLogin);
            elements.signupForm?.addEventListener('submit', handleSignup);
            
            // Auth tabs
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    const tabName = e.target.dataset.tab;
                    switchAuthTab(tabName);
                });
            });
            
            // Admin tabs
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    const tabName = e.target.dataset.tab;
                    switchAdminTab(tabName);
                });
            });
            
            // Color options
            document.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', (e) => {
                    document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('active'));
                    e.target.classList.add('active');
                    currentTshirtColor = e.target.dataset.color;
                });
            });
            
            // Navigation
            document.getElementById('shop-now-btn')?.addEventListener('click', () => {
                document.querySelector('#shop').scrollIntoView({ behavior: 'smooth' });
            });
            
            document.getElementById('custom-design-btn')?.addEventListener('click', () => {
                document.querySelector('#customize').scrollIntoView({ behavior: 'smooth' });
            });
        }

        async function loadProducts() {
            try {
                const products = await api.getProducts();
                renderProducts(products);
                populateProductSelect(products);
            } catch (error) {
                showToast('Failed to load products', 'error');
            }
        }

        function renderProducts(products) {
            const container = elements.productsGrid;
            if (!container) return;
            
            container.innerHTML = products.map(product => `
                <div class="product-card">
                    <div class="product-image">
                        <img src="${product.image}" alt="${product.name}">
                    </div>
                    <div class="product-info">
                        <h3>${product.name}</h3>
                        <p>${product.description}</p>
                        <div class="product-price">$${product.price.toFixed(2)}</div>
                        <button class="btn btn-primary" onclick="addProductToCart('${product.id}')">
                            <i class="fas fa-cart-plus"></i> Add to Cart
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function populateProductSelect(products) {
            const select = elements.productSelect;
            if (!select) return;
            
            select.innerHTML = '<option value="" disabled selected>Choose a product</option>' +
                products.map(product => `
                    <option value="${product.id}" data-price="${product.price}">${product.name} - $${product.price.toFixed(2)}</option>
                `).join('');
            
            select.addEventListener('change', (e) => {
                const option = e.target.selectedOptions[0];
                document.getElementById('product-price').textContent = option.dataset.price;
                
                // Update size options
                const product = products.find(p => p.id === e.target.value);
                if (product) {
                    updateSizeOptions(product.sizes);
                }
            });
            
            // Select first product by default
            if (products.length > 0) {
                select.value = products[0].id;
                document.getElementById('product-price').textContent = products[0].price.toFixed(2);
                updateSizeOptions(products[0].sizes);
            }
        }

        function updateSizeOptions(sizes) {
            const container = elements.sizeOptions;
            if (!container) return;
            
            container.innerHTML = sizes.map(size => `
                <button type="button" class="btn btn-outline size-option" data-size="${size}">${size}</button>
            `).join('');
            
            // Add event listeners
            container.querySelectorAll('.size-option').forEach(btn => {
                btn.addEventListener('click', () => {
                    container.querySelectorAll('.size-option').forEach(b => {
                        b.classList.remove('btn-primary');
                        b.classList.add('btn-outline');
                    });
                    btn.classList.remove('btn-outline');
                    btn.classList.add('btn-primary');
                });
            });
            
            // Select first size
            const firstBtn = container.querySelector('.size-option');
            if (firstBtn) {
                firstBtn.classList.remove('btn-outline');
                firstBtn.classList.add('btn-primary');
            }
        }

        async function addToCart() {
            const productSelect = elements.productSelect;
            const sizeOption = document.querySelector('.size-option.btn-primary');
            
            if (!productSelect.value) {
                showToast('Please select a product', 'error');
                return;
            }
            
            if (!sizeOption) {
                showToast('Please select a size', 'error');
                return;
            }
            
            const products = await api.getProducts();
            const product = products.find(p => p.id === productSelect.value);
            
            if (!product) {
                showToast('Product not found', 'error');
                return;
            }
            
            const cartItem = {
                id: Date.now().toString(),
                productId: product.id,
                productName: product.name,
                price: product.price,
                size: sizeOption.dataset.size,
                color: currentTshirtColor,
                notes: document.getElementById('customization-notes').value,
                image: product.image
            };
            
            cart.push(cartItem);
            await api.updateCart(cart);
            updateCartUI();
            showToast('Added to cart!', 'success');
        }

        async function addProductToCart(productId) {
            const products = await api.getProducts();
            const product = products.find(p => p.id === productId);
            
            if (!product) {
                showToast('Product not found', 'error');
                return;
            }
            
            const cartItem = {
                id: Date.now().toString(),
                productId: product.id,
                productName: product.name,
                price: product.price,
                size: 'M',
                color: '#ffffff',
                notes: '',
                image: product.image
            };
            
            cart.push(cartItem);
            await api.updateCart(cart);
            updateCartUI();
            showToast('Added to cart!', 'success');
        }

        function updateCartUI() {
            const cartCount = document.querySelector('.cart-count');
            if (cartCount) {
                cartCount.textContent = cart.length;
            }
            
            const cartItems = document.getElementById('cart-items');
            if (!cartItems) return;
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<p style="text-align: center; padding: 2rem;">Your cart is empty</p>';
                document.querySelector('.total-amount').textContent = '$0.00';
                return;
            }
            
            let total = 0;
            cartItems.innerHTML = cart.map(item => {
                total += item.price;
                return `
                    <div class="cart-item">
                        <div style="width: 60px; height: 60px; margin-right: 1rem; flex-shrink: 0;">
                            <img src="${item.image}" alt="${item.productName}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 4px;">
                        </div>
                        <div style="flex-grow: 1;">
                            <div style="font-weight: 600;">${item.productName}</div>
                            <div style="font-size: 0.9rem; color: var(--gray-color);">
                                Size: ${item.size} | Color: <span style="display: inline-block; width: 12px; height: 12px; background: ${item.color}; border-radius: 2px;"></span>
                            </div>
                            <div style="font-weight: 700; color: var(--primary-color);">$${item.price.toFixed(2)}</div>
                        </div>
                        <button class="btn-text" onclick="removeFromCart('${item.id}')">
                            <i class="fas fa-trash" style="color: var(--accent-color);"></i>
                        </button>
                    </div>
                `;
            }).join('');
            
            document.querySelector('.total-amount').textContent = `$${total.toFixed(2)}`;
        }

        async function removeFromCart(itemId) {
            cart = cart.filter(item => item.id !== itemId);
            await api.updateCart(cart);
            updateCartUI();
            showToast('Removed from cart', 'info');
        }

        async function handleCheckout(e) {
            e.preventDefault();
            
            if (cart.length === 0) {
                showToast('Your cart is empty', 'error');
                return;
            }
            
            const customerName = document.getElementById('customer-name').value;
            const customerEmail = document.getElementById('customer-email').value;
            const customerPhone = document.getElementById('customer-phone').value;
            const shippingAddress = document.getElementById('shipping-address').value;
            
            if (!customerName || !customerEmail || !customerPhone || !shippingAddress) {
                showToast('Please fill in all fields', 'error');
                return;
            }
            
            const total = cart.reduce((sum, item) => sum + item.price, 0);
            
            try {
                const orderData = {
                    customerName,
                    customerEmail,
                    customerPhone,
                    shippingAddress,
                    items: cart,
                    total,
                    status: 'pending'
                };
                
                const order = await api.createOrder(orderData);
                
                // Clear cart
                cart = [];
                await api.updateCart(cart);
                updateCartUI();
                
                // Hide modal
                hideModal('checkout-modal');
                
                // Reset form
                e.target.reset();
                
                showToast(`Order #${order.id} placed successfully!`, 'success');
                
                // Reload orders if user is logged in
                if (api.currentUser) {
                    await loadUserOrders();
                }
                
            } catch (error) {
                showToast(error.message || 'Failed to place order', 'error');
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            try {
                const result = await api.login(email, password);
                showAuthenticatedUI(result.user);
                hideModal('login-modal');
                showToast('Login successful!', 'success');
                
                // Load user data
                await loadUserData();
                
            } catch (error) {
                showToast(error.message || 'Login failed', 'error');
            }
        }

        async function handleSignup(e) {
            e.preventDefault();
            
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            
            try {
                const result = await api.signup({ email, password, name });
                showAuthenticatedUI(result.user);
                hideModal('login-modal');
                showToast('Account created!', 'success');
                
                // Load user data
                await loadUserData();
                
            } catch (error) {
                showToast(error.message || 'Signup failed', 'error');
            }
        }

        async function handleLogout() {
            await api.logout();
            showUnauthenticatedUI();
            showToast('Logged out', 'info');
        }

        function checkAuthState() {
            if (api.currentUser) {
                showAuthenticatedUI(api.currentUser);
                loadUserData();
            } else {
                showUnauthenticatedUI();
            }
        }

        function showAuthenticatedUI(user) {
            elements.loginBtn.style.display = 'none';
            elements.logoutBtn.style.display = 'block';
            
            if (user.role === 'admin') {
                elements.adminLink.style.display = 'block';
            }
        }

        function showUnauthenticatedUI() {
            elements.loginBtn.style.display = 'block';
            elements.logoutBtn.style.display = 'none';
            elements.adminLink.style.display = 'none';
            elements.adminSection.style.display = 'none';
        }

        async function loadUserData() {
            if (!api.currentUser) return;
            
            // Load cart
            cart = await api.getCart();
            updateCartUI();
            
            // Load orders
            await loadUserOrders();
            
            // Load admin data if admin
            if (api.currentUser.role === 'admin') {
                await loadAdminData();
            }
        }

        async function loadUserOrders() {
            try {
                const orders = await api.getOrders();
                renderUserOrders(orders);
            } catch (error) {
                console.error('Failed to load orders:', error);
            }
        }

        function renderUserOrders(orders) {
            const container = document.getElementById('orders-container');
            if (!container) return;
            
            if (orders.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--gray-color);">
                        <i class="fas fa-box-open" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                        <p>You haven't placed any orders yet</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = orders.map(order => `
                <div class="order-card" style="background: white; padding: 1.5rem; border-radius: var(--border-radius); margin-bottom: 1rem; box-shadow: var(--shadow);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <div>
                            <strong>Order #${order.id}</strong>
                            <div style="font-size: 0.9rem; color: var(--gray-color);">
                                ${new Date(order.createdAt).toLocaleDateString()}
                            </div>
                        </div>
                        <span style="background: ${getStatusColor(order.status)}; color: white; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem;">
                            ${order.status}
                        </span>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        ${order.items?.map(item => `
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #eee;">
                                <div>${item.productName}</div>
                                <div>$${item.price.toFixed(2)}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div style="text-align: right; font-weight: 700; font-size: 1.2rem; color: var(--primary-color);">
                        Total: $${order.total.toFixed(2)}
                    </div>
                </div>
            `).join('');
        }

        async function loadAdminData() {
            try {
                const orders = await api.getOrders();
                renderAdminOrders(orders);
                
                const products = await api.getProducts();
                renderAdminProducts(products);
                
            } catch (error) {
                console.error('Failed to load admin data:', error);
            }
        }

        function renderAdminOrders(orders) {
            const tbody = document.getElementById('admin-orders-table');
            if (!tbody) return;
            
            tbody.innerHTML = orders.map(order => `
                <tr>
                    <td>#${order.id}</td>
                    <td>${order.customerName}<br><small>${order.customerEmail}</small></td>
                    <td>$${order.total.toFixed(2)}</td>
                    <td>
                        <select onchange="updateOrderStatus('${order.id}', this.value)" 
                                style="padding: 0.3rem; border-radius: 4px; border: 1px solid #ddd;">
                            <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
                            <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>Processing</option>
                            <option value="shipped" ${order.status === 'shipped' ? 'selected' : ''}>Shipped</option>
                            <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>Delivered</option>
                        </select>
                    </td>
                    <td>${new Date(order.createdAt).toLocaleDateString()}</td>
                </tr>
            `).join('');
        }

        function renderAdminProducts(products) {
            const tbody = document.getElementById('admin-products-table');
            if (!tbody) return;
            
            tbody.innerHTML = products.map(product => `
                <tr>
                    <td>${product.name}</td>
                    <td>${product.category}</td>
                    <td>$${product.price.toFixed(2)}</td>
                    <td>${product.stock}</td>
                    <td>
                        <button class="btn-text" onclick="editProduct('${product.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        async function updateOrderStatus(orderId, status) {
            try {
                await api.updateOrder(orderId, { status });
                showToast('Order updated', 'success');
                
                // Reload admin data
                await loadAdminData();
                
            } catch (error) {
                showToast('Failed to update order', 'error');
            }
        }

        // Utility Functions
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        }

        function switchAuthTab(tabName) {
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === tabName);
            });
            
            document.querySelectorAll('.auth-form').forEach(form => {
                form.classList.remove('active');
            });
            
            document.getElementById(`${tabName}-form`).classList.add('active');
        }

        function switchAdminTab(tabName) {
            document.querySelectorAll('.admin-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.admin-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(`admin-${tabName}`)?.classList.add('active');
            event.target.classList.add('active');
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            if (!container) return;
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas fa-${getToastIcon(type)}"></i>
                <div>${message}</div>
                <button class="btn-text" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 5000);
        }

        function getToastIcon(type) {
            switch(type) {
                case 'success': return 'check-circle';
                case 'error': return 'exclamation-circle';
                case 'warning': return 'exclamation-triangle';
                default: return 'info-circle';
            }
        }

        function getStatusColor(status) {
            switch(status) {
                case 'pending': return '#f39c12';
                case 'processing': return '#3498db';
                case 'shipped': return '#9b59b6';
                case 'delivered': return '#27ae60';
                default: return '#95a5a6';
            }
        }

        async function showAddProductModal() {
            const name = prompt('Product name:');
            if (!name) return;
            
            const price = parseFloat(prompt('Price:'));
            if (isNaN(price)) return;
            
            const category = prompt('Category (men/women/unisex):');
            const stock = parseInt(prompt('Stock quantity:'));
            
            try {
                await api.createProduct({
                    name,
                    price,
                    category: category || 'unisex',
                    stock: stock || 0,
                    description: prompt('Description:') || '',
                    sizes: ['S', 'M', 'L', 'XL'],
                    image: prompt('Image URL:') || 'https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
                });
                
                showToast('Product added', 'success');
                await loadProducts();
                await loadAdminData();
                
            } catch (error) {
                showToast(error.message || 'Failed to add product', 'error');
            }
        }

        // Expose functions to global scope
        window.removeFromCart = removeFromCart;
        window.addProductToCart = addProductToCart;
        window.updateOrderStatus = updateOrderStatus;
        window.showAddProductModal = showAddProductModal;
        window.showAdminSection = function() {
            elements.adminSection.style.display = 'block';
            document.querySelector('#admin').scrollIntoView({ behavior: 'smooth' });
            loadAdminData();
        };

        // Handle admin link click
        document.getElementById('admin-link')?.addEventListener('click', (e) => {
            e.preventDefault();
            showAdminSection();
        });

        // Mobile menu toggle
        document.getElementById('menu-toggle')?.addEventListener('click', () => {
            document.querySelector('.nav-links').classList.toggle('active');
        });
    </script>

    <!-- ============================================ -->
    <!-- DEPLOYMENT CONFIGURATION (Node.js Server) -->
    <!-- ============================================ -->
    <!-- 
    To deploy this as a complete full-stack app:

    1. Save this file as "server.js"
    2. Install dependencies: npm install express
    3. Run: node server.js

    OR deploy to:
    - Heroku: Create Procfile with: web: node server.js
    - Render: Set start command to: node server.js
    - Railway: Auto-detects Node.js

    For production:
    1. Add environment variables
    2. Add database (MongoDB, PostgreSQL)
    3. Add authentication (JWT, sessions)
    4. Add file upload for designs
    5. Add payment integration (Stripe, PayPal)
    -->

    <script>
        // This script will only run if executed by Node.js
        if (typeof module !== 'undefined' && module.exports) {
            const express = require('express');
            const fs = require('fs');
            const path = require('path');
            
            const app = express();
            const PORT = process.env.PORT || 3000;
            
            // Serve static files
            app.use(express.static(__dirname));
            
            // Serve the HTML file
            app.get('/', (req, res) => {
                res.sendFile(path.join(__dirname, 'index.html'));
            });
            
            // API endpoints
            app.use(express.json());
            
            // Simple in-memory database for demo
            let database = {
                users: [],
                products: [],
                orders: [],
                carts: {}
            };
            
            // Load initial data
            function loadInitialData() {
                database.users = [
                    {
                        id: '1',
                        email: 'admin@example.com',
                        password: 'admin123',
                        name: 'Admin User',
                        role: 'admin',
                        createdAt: new Date().toISOString()
                    }
                ];
                
                database.products = [
                    {
                        id: '1',
                        name: 'Premium Cotton T-Shirt',
                        description: '100% cotton, soft and comfortable',
                        price: 29.99,
                        category: 'unisex',
                        sizes: ['S', 'M', 'L', 'XL'],
                        stock: 100,
                        image: 'https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
                    },
                    {
                        id: '2',
                        name: 'Classic Polo Shirt',
                        description: 'Premium polo shirt with logo',
                        price: 39.99,
                        category: 'men',
                        sizes: ['M', 'L', 'XL', 'XXL'],
                        stock: 75,
                        image: 'https://images.unsplash.com/photo-1586790170083-2f9ceadc732d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
                    }
                ];
                
                database.orders = [];
                database.carts = {};
            }
            
            loadInitialData();
            
            // Auth endpoints
            app.post('/api/login', (req, res) => {
                const { email, password } = req.body;
                const user = database.users.find(u => u.email === email && u.password === password);
                
                if (!user) {
                    return res.status(401).json({ error: 'Invalid credentials' });
                }
                
                const { password: _, ...userWithoutPassword } = user;
                res.json({ success: true, user: userWithoutPassword });
            });
            
            app.post('/api/signup', (req, res) => {
                const { email, password, name } = req.body;
                
                if (database.users.find(u => u.email === email)) {
                    return res.status(400).json({ error: 'User already exists' });
                }
                
                const newUser = {
                    id: Date.now().toString(),
                    email,
                    password,
                    name,
                    role: 'customer',
                    createdAt: new Date().toISOString()
                };
                
                database.users.push(newUser);
                const { password: _, ...userWithoutPassword } = newUser;
                res.json({ success: true, user: userWithoutPassword });
            });
            
            // Products endpoints
            app.get('/api/products', (req, res) => {
                res.json(database.products);
            });
            
            app.post('/api/products', (req, res) => {
                const product = req.body;
                product.id = Date.now().toString();
                database.products.push(product);
                res.json(product);
            });
            
            // Orders endpoints
            app.post('/api/orders', (req, res) => {
                const order = req.body;
                order.id = 'ORD' + Date.now().toString().slice(-8);
                order.createdAt = new Date().toISOString();
                order.status = 'pending';
                
                database.orders.push(order);
                
                // Clear cart
                if (order.userId) {
                    database.carts[order.userId] = [];
                }
                
                res.json(order);
            });
            
            app.get('/api/orders', (req, res) => {
                const { userId } = req.query;
                
                let orders = database.orders;
                if (userId) {
                    orders = orders.filter(order => order.userId === userId);
                }
                
                res.json(orders);
            });
            
            app.put('/api/orders/:id', (req, res) => {
                const { id } = req.params;
                const updates = req.body;
                
                const order = database.orders.find(o => o.id === id);
                if (order) {
                    Object.assign(order, updates);
                    res.json(order);
                } else {
                    res.status(404).json({ error: 'Order not found' });
                }
            });
            
            // Cart endpoints
            app.get('/api/cart/:userId', (req, res) => {
                const { userId } = req.params;
                res.json(database.carts[userId] || []);
            });
            
            app.post('/api/cart/:userId', (req, res) => {
                const { userId } = req.params;
                const items = req.body;
                database.carts[userId] = items;
                res.json({ success: true });
            });
            
            // Start server
            app.listen(PORT, () => {
                console.log(`Server running on port ${PORT}`);
                console.log(`Open http://localhost:${PORT} in your browser`);
            });
            
            module.exports = app;
        }
    </script>
</body>
</html>